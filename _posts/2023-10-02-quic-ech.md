---
layout: post
title: QUIC and HTTP/3, QUIC versus TCP and encrypted TLS ClientHello
tag: quic, http, tls, tcp, privacy
author: Olivier Bonaventure
---

The web is moving towards [HTTP/3]([https://tools.ietf.org/html/rfc9014](https://tools.ietf.org/html/rfc9000)) above the [QUIC](https://tools.ietf.org/html/rfc9000) protocol that replaces the traditional HTTP over TLS over TLS stack with a new protocol that runs directly above UDP and can be deployed inside applications. [Robin Marx](https://twitter.com/programmingart?lang=en) explains in a [blog post Why HTTP/3 is eating the world](https://blog.apnic.net/2023/09/25/why-http-3-is-eating-the-world/).

A [recent study compares the performance of different TCP extensions and QUIC](https://arxiv.org/abs/2309.10516) to download files from CDN servers. The measurements first looked at the deployment of TCP extensions. They studied TCP [SACK](https://www.rfc-editor.org/rfc/rfc2018), [Windows Scale](https://tools.ietf.org/html/rfc1323) and [Explicit Congestion Notification](https://www.rfc-editor.org/rfc/rfc3168). Surprisingly, 5.3% of the domains in the Top 1M list did not support any extension. This is very strange for Window Scale that was defined in [RFC1323](https://tools.ietf.org/html/rfc1323) published 31 years ago. ECN is only supported by 85.8% of the domains, but for ECN, the main problem remains that congested routers rarely mark packets using ECN. For TCP, the measurements reveal that Window Scale improves throughput, which is not a surprise. More interesting is that the [quiche](https://github.com/cloudflare/quiche) implementation of [QUIC](https://tools.ietf.org/html/rfc9000) seems to outperform TCP for 70% of the samples. Unfortunately, the paper does not try to explain why QUIC performs better than TCP in these measurements.

In parallel with the deployment of QUIC, TLS continues to be improved. A TLS session starts with a ClientHello message that is sent in clear text. Some middleboxes and firewalls use this to extract the Server Name Indication and detect the target of the TLS session. This will change with the deployment of [Encrypted Client Hello](https://datatracker.ietf.org/doc/draft-ietf-tls-esni/) that allows to encrypt the ClientHello message using the server's public key. On the client side, this extension is enabled in [Chrome 117](https://chromestatus.com/feature/6196703843581952) and will [appear soon in Firefox](https://www.elevenforum.com/t/encrypted-client-hello-now-available-in-firefox-and-cloudflare.14924/).


You can follow this blog by subscribing to its [RSS feed](http://blog.computer-networking.info/feed.xml) or by following [@cnp3_ebook on mastodon](https://mastodon.acm.org/@cnp3_ebook). 